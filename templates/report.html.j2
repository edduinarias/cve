<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Informe CVE-2025-24813 - {{ ansible_date_time.date }}</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; color: #222; }
h1 { color: #a00; }
table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
th, td { border: 1px solid #ddd; padding: 8px; vertical-align: top; }
th { background: #f2f2f2; text-align: left; }
.vulnerable { background: #ffcccc; font-weight: bold; color: #900; }
.safe { background: #d4ffd4; font-weight: bold; color: #060; }
.unknown { background: #fff8c4; font-weight: bold; color: #665500; }
pre { background: #fafafa; padding: 6px; border: 1px solid #eee; overflow:auto; }
</style>
</head>
<body>
<h1>Informe CVE-2025-24813</h1>
<p>Generado: {{ ansible_date_time.iso8601 }}</p>

<h2>Resumen: Hosts y versión de Tomcat</h2>
<table>
<thead>
<tr>
<th>Host</th>
<th>Versión Tomcat</th>
<th>Resultado</th>
<th>Salida de version.sh</th>
</tr>
</thead>
<tbody>
{% for s in hosts_summary %}
<tr class="{% if s.vulnerability_status == 'Vulnerable' %}vulnerable{% elif s.vulnerability_status == 'No vulnerable' %}safe{% else %}unknown{% endif %}">
<td>{{ s.host }}</td>
<td>{{ s.tomcat_pkg_version_display }}</td>
<td>{{ s.vulnerability_status }}</td>
<td><pre>{{ s.catalina_raw }}</pre></td>
</tr>
{% endfor %}
</tbody>
</table>

<h2>Detalles por host</h2>
{% for r in reports %}
<h3>{{ r.host }}</h3>
<table>
<tr><th>SO</th><td>{{ r.os }}</td></tr>
<tr><th>Versión Tomcat</th><td><pre>{{ r.tomcat_pkg_version | to_nice_json }}</pre></td></tr>
<tr><th>Catalina</th><td><pre>{{ r.catalina_version_raw }}</pre></td></tr>
<tr><th>Archivos de sesión</th><td><pre>{{ r.session_files_found | to_nice_json }}</pre></td></tr>
<tr><th>Métodos permitidos (OPTIONS)</th><td><pre>{{ r.options_allow_header }}</pre></td></tr>
<tr><th>PUT habilitado</th><td>{{ r.test_put_enabled }}</td></tr>
</table>
{% endfor %}

<h3>Rangos vulnerables conocidos</h3>
<ul>
<li>Tomcat 9.0.0-M1 → 9.0.98</li>
<li>Tomcat 10.1.0-M1 → 10.1.34</li>
<li>Tomcat 11.0.0-M1 → 11.0.2</li>
</ul>
</body>
</html>
